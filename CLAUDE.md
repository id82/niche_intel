# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

NicheIntel Pro is a Chrome extension that analyzes Amazon search results and book pages to extract market intelligence data for publishers. The extension scans Amazon search result pages, extracts product information, and generates comprehensive reports with pricing, sales data, and market insights.

## Development Commands

### Build and Package
- `npm run build` - Build the extension for production using webpack
- `npm run dev` - Build in development mode with file watching
- `npm run package` - Build and create a ZIP file for Chrome Web Store submission

### Development Workflow
- Use `npm run dev` during development for automatic rebuilding
- Built files are output to `dist/` directory
- The `create-zip.js` script packages the `dist/` folder for distribution

## Architecture Overview

### Core Components

**Background Script** (`background.js`)
- Service worker that manages extension lifecycle
- Handles resource blocking to improve scraping performance
- Manages tab monitoring and analysis coordination
- Coordinates between content scripts and report generation

**Content Script** (`book_page_info.js`)
- Injected into Amazon product pages
- Extracts book-specific data (price, BSR, page count, etc.)
- Validates page type (books vs other products)
- Communicates with background script for data processing

**Report System** (`report.js`, `report.html`, `report.css`)
- Generates comprehensive data analysis reports
- Implements complex table layout with sticky headers/footers
- Handles data visualization and filtering
- Manages scroll synchronization between table sections

**Scrapers** (`scrapers.js`)
- Contains core scraping logic for Amazon search results
- Extracts product information from search result cards
- Handles different Amazon marketplace variations
- Processes SERP (Search Engine Results Page) data

**Offscreen Document** (`offscreen.js`, `offscreen.html`)
- Handles operations requiring DOM access outside content scripts
- Used for data processing that needs a document context

### Data Flow

1. User initiates analysis on Amazon search results page
2. `book_page_info.js` extracts initial product data
3. `background.js` coordinates deeper analysis using `scrapers.js`
4. Data is processed and stored in Chrome storage
5. `report.js` generates comprehensive report with filtering and visualization
6. Report is displayed in new tab with interactive table

### Key Technical Patterns

**Webpack Build System**
- Multi-entry configuration for different script types
- CSS and HTML processing with minification
- Source map generation for debugging
- Asset copying for icons and static files

**Table Layout Architecture**
- Complex flexbox-based table with sticky positioning
- Horizontal scroll synchronization between header and body
- Wrapper div pattern for tbody to handle overflow conflicts
- Positioned sticky rows for focused content

**Chrome Extension Architecture**
- Manifest V3 with service worker background
- Content script injection on Amazon domains
- Web accessible resources for report files
- Declarative net request rules for performance optimization

## File Organization

- `/` - Extension files (JS, HTML, CSS, manifest)
- `/dist/` - Built extension files (generated by webpack)
- `/icons/` - Extension icons in various sizes
- `/node_modules/` - Dependencies
- `webpack.config.js` - Build configuration
- `create-zip.js` - Packaging script for distribution

## Important Notes

- The extension targets multiple Amazon marketplaces (US, UK, DE, FR, IT, ES, NL, AU, JP, PL, SE)
- Resource blocking is implemented to improve scraping performance
- The report system uses a sophisticated table layout that separates vertical scrolling (tbody) from horizontal scrolling (container)
- Data persistence uses Chrome storage API for cross-tab communication
- The extension requires specific permissions for Amazon domains and declarative net requests

## Testing and Debugging

- Development builds include source maps for debugging
- Console logging is preserved in production builds
- Use Chrome DevTools with extension context for debugging
- Monitor background script logs in extension service worker context
- Content script logs appear in page console

## GitHub workflow
Make sure to increment the manifest.json version of this chrome extension by X.X.1 every time you make an update. Plus commit and push the changes to GitHub and include the version number in the commit comment.